\chapter{Introduction}
\label{cha:introduction}
    In this thesis, a proposed high-level control system is presented
    for the quadrotor developed by the AIICS\footnote{\url{http://www.ida.liu.se/divisions/aiics/}}
    team at Link√∂ping University, the LinkQuad.
    The system was to demonstrate autonomous landing, and while this goal
    could not be reached within the time-frame of this Master's thesis, the control
    system developed in this thesis show promising initial results on
    the path to achieving autonomous landing and aerial control.

    Although the LinkQuad quadrotor was used as development platform for this thesis,
    the results are general and applicable to other quadrotors and, by extension, other UAV configurations.

    The LinkQuad is considered a MAV, a Micro Air Vehicle. % - A UAV small enough to be carried by man \citep{wiki:suav}.
    The size of the system poses limitations on the payload and processing power
    available in-flight. This means that the implementations has to be done
    in an efficient manner on the small computers that are available on the LinkQuad.

    These limitations, however, does not necessarily limit us from utilizing advanced estimation
    and control techniques, and the LinkQuad design is in fact
    quite suitable for the camera-based pose estimation due to its dual
    onboard computers which allows distribution of the workload.
    The video-based estimation can thus effectively be detached from the
    core control and state estimation and modularized as an independent
    virtual sensor, which is exploited in this thesis.

\section{Unmanned Aerial Vehicles}
    Unmanned Aerial Vehicles (UAVs) have been imagined and constructed for millennia, starting in ancient Greece and China \citep{valavanis2007advances}.
    The modern concept of UAVs was introduced in the first world war, which
    illuminates the dominant role that the military has played in the field over the
    last century. A commonly cited alliteration is that UAVs are intended to replace
    human presence in missions that are ''Dull, Dirty and Dangerous''.

    While the military continues to lead the development in the field \citep{united2010u}, recent years
    have seen a great increase in domestic and civilian applications \citep{Wong_Bil_2006}.
    These applications range from pesticide dispersing and crop monitoring to
    traffic control, border watch and rescue scenarios \citep{Doherty_Rudol_2007}.

    The type of UAV that is used in the implementation of this thesis
    falls under the category of Micro Air Vehicles (MAVs)\footnote{Definitions differ for the classification of UAVs,
    although a weight less than $5$~kg has been proposed \citep{arjomandi:classification}.
    Other terms, such as \textit{Small UAVs} (SUAVs), are used by e.g. \citep{valavanis2007advances}.}.
    MAVs are designed to be man-portable in weight and size and is thus
    limited in payload and available processing power.
    This limitation, in combination with the unavailability of indoor positioning (e.g. GPS),
    has led to extensive use of off-board positioning and control in recent research.
    Systems developed for instance by Vicon\footnote{\url{http://www.vicon.com/}} and
    Qualisys\footnote{\url{http://www.qualisys.com/}} yield positioning with
    remarkable precision, but they also limit the application to a confined
    environment with an expensive setup.

    This thesis seeks a different approach, with an efficient self-contained
    on-board implementation. GPS and external cameras are replaced by inertial sensors and an
    on-board camera which uses visual SLAM to determine the position of the LinkQuad relative to
    its surroundings.



\input{\currentchapter/platform}
\input{\currentchapter/previouswork}



\section{Objectives and Limitations}
    The main objective for this thesis was to create a control system
    for the LinkQuad capable of autonomous landing, using state estimation
    aided by visual feedback.
    To achieve this, methods and algorithms for control and positioning
    were to be implemented as nescessary to incorporate the complex measurements
    from the camera positioning into the state estimate.
    With the pose estimate and control available, landing is a matter of generating
    a suitable trajectory and detecting the completion of the landing.

    Although time restricted the final demonstration of landing, the necessary tools
    were implemented, albeit lacking the tuning necessary for real flight.

    This thesis does not cover the detection of suitable landing sites,
    nor any advanced flight control in limited space or with collision detection.
    The quadrotor modeling is extensive, but is mostly limited to a study
    of literature on the subject.

\section{Contributions}
    During the thesis work, several tools for future development have been
    designed and developed. The \crap framework collects tools that are usable in future
    projects and theses, both on the LinkQuad and otherwise.
    The modules implemented in the \crap framework include:
    \begin{itemize}
        \item General nonlinear filtering, using EKF or UKF,
        \item General nonlinear control, implemented as affine quadratic control,
        \item Extendable scheduling and reasoning through state-machines,
        %~ \item Real-time plotting,
        \item Communication API for internal and external communication.
    \end{itemize}

    Furthermore, a general physical model of a quadrotor has been assembled.
    The model extends and clarifies the many sources of physical modeling
    available, and is presented in a scalable, general manner.

    The state estimation proposed in this thesis uses a detailed physical model
    derived in Chapter~\ref{cha:observer}. While the model still needs
    tuning, it does show promising results, and a physically modeled
    quadrotor could potentially improve in-flight performance~\citep{bouabdallah07full}.

    In Chapter~\ref{cha:observer}, a general method for attaining
    the world-to-PTAM transformation is proposed.
    This method is useful for extending the utility of the PTAM
    camera positioning library to more than its intended use in Augmented Reality applications.
    The utility for this has already been proven in e.g.~\citep{weiss11monocular},
    and providing the theory and implementation for this, as well as a proposed
    initialization routine, may be relevantly applied to future work.
    The PTAM library has also been extended with full autonomous operation by
    proposing an automated initialization procedure, as well as providing
    full detachment from the graphical user interface.

    All tools developed during the thesis are released under the GPL license
    and are available online at \url{https://github.com/jonatanolofsson/}.

\section{Thesis Outline}
    Following the introductory chapter, four chapters are devoted to
    presenting the theory used in the implementation.
    The primary sensor used in this thesis, the camera, is introduced
    in Chapter~\ref{cha:monoslam} on the topic of Monocular SLAM.
    The camera provide positioning measurements that are incorporated
    into a positioning framework in Chapter~\ref{cha:observer}.
    The state estimate obtained from the positioning is then used in Chapter~\ref{cha:controller},
    which introduces an approach to nonlinear control of the quadrotor.
    Chapter~\ref{cha:logic} presents the trajectory generation algorithms
    used to perform landing and flight, as implemented in terms of \textit{state-machines}.

    The following two chapters of the thesis, Chapters~\ref{cha:results} and \ref{cha:discussion}, present the
    numerical evaluation of the result and the following discussion respectively.
    Concluding remarks and suggestions for further work are finally presented in Chapter~\ref{cha:conclusions}.

    A technical description of the \crap framework, developed for the
    implementation of this thesis, is appended.
