\section{Filtering}
\label{sec:results:filtering}
The filter implementation was evaluated with recorded data as described in Section~\ref{sec:results:setup}.
Due to model stability issues, as discussed in Chapter~\ref{cha:discussion},
the EKF-filter was selected for evaluation.

\subsection{Positioning}
    The position estimate generally exhibit very good performance relative
    to the ground truth.
    This reflects the fact that the position states are observed,
    in the state estimation, more or less directly by the camera,
    which exhibit stable positioning in the validation.

    In the plot of the altitudinal positioning in Figure~\ref{fig:results:filtering:position},
    the estimates from the pre-existing complementary filter -
    moved to share the initial conditions of the Kalman filter - was added for
    comparison. The complementary filter exhibits problems associated
    with the pressure sensor, while the camera-based positioning is stable
    throughout the validation.

    \begin{subfigures}{Positioning in the horizontal directions well
    corresponds to the ground truth, thanks to the camera positioning.
    For the altitude, the estimation of the pre-existing complementary filter is added for comparison, its starting point adjusted to produce comparable plots.}{fig:results:filtering:position}
        \sfig{\splotwidth}{X}
        \sfig{\splotwidth}{Y}
        \sfig{\splotwidth}{Z}
    \end{subfigures}

\subsection{Velocities}
    The velocities, being closely coupled with the camera observed position,
    also exhibit good performance (Figure~\ref{fig:results:filtering:velocities}).
    There are shortcomings to the estimation's horizontal precision, although
    this could probably be significantly improved with further filter tuning
    and the availability of control signals to the motion model.
    \begin{subfigures}{Velocity estimates are generally adequate, but with more tuning, the results are likely to improve.}{fig:results:filtering:velocities}
        \sfig{\splotwidth}{velX}
        \sfig{\splotwidth}{velY}
        \sfig{\splotwidth}{velZ}
    \end{subfigures}

\subsection{Orientation, Rotational Velocity and Gyroscope Bias}
    Along with the position, the orientation is estimated from the camera,
    yielding notable precision, as seen in Figure~\ref{fig:results:filtering:qwb}.

    The bias of the gyroscopes is removed during the initialization process.
    Since the time-frame of the tests were far less than the time expected to
    detect a change in the bias, these should thus be estimated to zero,
    as verified in Figure~\ref{fig:results:filtering:drift}.

    As noted in Section~\ref{ssec:results:modelling:gyroscopes}, the
    filtering of the rotational velocities of the quadrotor body,
    exhibited with their associated covariance in Figure~\ref{fig:results:filtering:omega},
    correlates very well to the measurements.
    In Figure~\ref{fig:results:filtering:headings}, the Kalman filter performance is compared
    to the previously existing complementary filter. It can be seen that
    the prediction update of the Kalman filter improves the phase of the filter,
    although towards the end of the dataset, they are of comparable performance.

    \begin{subfigures}{Due to the camera positioning, the orientation of the quadrotor was estimated with good accuracy.}{fig:results:filtering:qwb}
        \sfig{\sfplotwidth}{qwb0}
        \sfig{\sfplotwidth}{qwbi}
        \sfig{\sfplotwidth}{qwbj}
        \sfig{\sfplotwidth}{qwbk}
    \end{subfigures}

    \begin{subfigures}{The predicted angular velocities corresponds very well to the gyro measurements.}{fig:results:filtering:omega}
        \sfig{\splotwidth}{wRoll}
        \sfig{\splotwidth}{wPitch}
        \sfig{\splotwidth}{wYaw}
    \end{subfigures}

    \begin{subfigures}{The gyroscopes' drift was removed prior to entering the filter, and does not change during the short recording of data.}{fig:results:filtering:drift}
        \sfig{\splotwidth}{driftRoll}
        \sfig{\splotwidth}{driftPitch}
        \sfig{\splotwidth}{driftYaw}
    \end{subfigures}
    \fig{\plotwidth}{headings}{A comparison with the tuned complementary filter show that both filters accurately describe the heading, and although the phase of the Kalman filter is better in the beginning, they are of comparable performance towards the end of the dataset.}{fig:results:filtering:headings}

\subsection{Wind Force}
    As the tests were performed inside, the filter was tuned to keep the
    wind at a zero velocity estimate.
    Figure~\ref{fig:results:filtering:wind} shows them to be correctly estimated to zero in the collected dataset,
    although in the case with simulated data with wind, shown in Figure~\ref{fig:results:filtering:simwind},
    results are quite poor, most likely due to lack of filter tuning.

    In simulations to verify the wind estimate's behaviour at landing, it
    is evident that the wind estimate is affected by ground contact.
    However, as the simulation model does not yet fully cover the the non-continuous
    event of touching the ground, the simulated wind estimates are not quite as expected, as shown in
    Figure~\ref{fig:results:filtering:windbump} and discussed in Chapter~\ref{cha:discussion}.

    \begin{subfigures}{Wind estimates from recorded test-data.}{fig:results:filtering:wind}
        \sfig{\splotwidth}{windX}
        \sfig{\splotwidth}{windY}
        \sfig{\splotwidth}{windZ}
    \end{subfigures}

    \begin{subfigures}{Wind from simulated test-flight.}{fig:results:filtering:simwind}
        \sfig{\splotwidth}{simwindX}
        \sfig{\splotwidth}{simwindY}
        \sfig{\splotwidth}{simwindZ}
    \end{subfigures}

    \fig{\plotwidth}{windbump}{Even in simulation, the landing was detectable in the vertical wind estimate, although more work is required to properly model and detect the event.}{fig:results:filtering:windbump}

\subsection{Propeller Velocity}
    As the filter evaluation was performed without the use of the controller,
    the control signal is unavailable. Thus, Eq.~\eqref{eq:observer:wri2} was used as
    prediction model for the propeller velocity in the filter validation, effectively leaving the estimation of the propeller velocities
    to the measurement update. It is evident, in Figure~\ref{fig:results:filtering:wr}
    that the estimation is active, however it is impossible to validate properly with the available data.
    Ideally, the velocities of the propellers should be measured in flight, although
    that data is currently unavailable on the LinkQuad.
    %~ The estimated velocities are, notably, in a reasonable range,
    %~ increasing the plausibility for correctness of Eq.~\eqref{eq:observer:thrust}, which is
    %~ otherwise hard to verify using the available data.

    \begin{subfigures}{Propeller angular rate estimates could not be properly verified with the data available, although do exhibit a reasonable value range given the model parameter settings.}{fig:results:filtering:wr}
        \sfig{\sfplotwidth}{wr1}
        \sfig{\sfplotwidth}{wr2}
        \sfig{\sfplotwidth}{wr3}
        \sfig{\sfplotwidth}{wr4}
    \end{subfigures}
