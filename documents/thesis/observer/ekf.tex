\section{The Extended Kalman Filter}
\label{sec:observer:ekf}
    \begin{algorithm}[Extended Kalman Filter]
        \label{alg:ekf}
        The Kalman filter in Algorithm \ref{alg:ekf} is in the Extended Kalman filter extended to the
        non-linear case by straight-forward linearization where nescessary.
        \begin{subequations}\textbf{Prediction update}
            \begin{equation}
                \hat{x}_{t|t-1} = f\left\( hat{x}_{t-t|t-1}, u_{t} \right)
            \end{equation}
            \begin{equation}
                P_{t|t-1} = A P_{t-1|t-1} A^{T} + Q
            \end{equation}
        \end{subequations}
        \begin{subequations}\textbf{Measurement update}
            \begin{equation}
                \label{eq:filtering:kalmanK}
                K = P_{t|t-1} H^{T} \left( H P_{t|t-1} H^{T} + R \right)^{-1}
            \end{equation}
            \begin{equation}
                \hat{x}_{t|t} = \hat{x}_{t|t-1} + K \left( y - h(\hat{x}_{t|t-1}) \right)
            \end{equation}
            \begin{equation}
                P_{t|t} = P_{t|t-1} + K H P_{t|t-1}
            \end{equation}
        \end{subequations}
        Where
        \begin{equation}
            \begin{array}{cc}
                A = \left.\frac{\partial f(x,u)}{\partial x}\right|_{x = \hat{x}_{t|t}}, & H = \left.\frac{\operatorname{d}\!h(x)}{\operatorname{d}\!x}\right|_{x = \hat{x}_{t|t-1}}
            \end{array}
        \end{equation}
    \end{algorithm}
