\section{Sensor Models}
\label{sec:observer:sensormodels}
    This section relates the estimated state of the quadrotor to the expected sensor measurements, $\hat{y}$.

    In UAV state estimation, it is common to include a GPS sensor, providing world-fixed measurements,
    to prevent drift in the filtering process. In this thesis, the GPS is replaced with a camera,
    which is discussed in detail in Section~\ref{ssec:observer:sensormodels:camera}, following
    a description of the accelerometers, gyroscopes, magnetometers and the pressure sensor.

    In the measurement equations in this section, a zero-mean Gaussian term $e$ with known covariance is added
    to account for measurement noise. The Gaussian assumption may in some
    cases be severely inappropriate, but the Kalman filter framework requires its use.

    \subsection{Accelerometers}
        The accelerometers, as the name suggests, provides measurements of the
        accelerations of the sensor. In general, this does not directly correspond
        to the accelerations of the mathematical center of gravity used
        as center of the measured vehicle. This motivates a correction
        for angular acceleration and velocity with regards to the sensor's
        relative position from the center of gravity, $r_{\text{acc}/\mathcal{G}}$.
        \begin{equation}
            \hat{y}_{\text{acc}} = a_{\mathcal{G}} + \dot{\omega} \times r_{\text{acc}/\mathcal{G}} + \omega \times \left( \omega \times r_{\text{acc}/\mathcal{G}} \right) + e_{\text{acc}}
        \end{equation}

    \subsection{Gyroscopes}
        Gyroscopes, or rate gyroscopes specifically, measure the angular velocity
        of the sensor. Unlike acceleration, the angular rate is theoretically
        invariant of the relative position of the sensor and the center of gravity.
        However, gyroscope measurements are associated with a bias which may
        change over time. This bias term may be introduced as a state variable in the observer,
        modeled constant as in Eq.~\eqref{eq:filter:sensormodels:accelerometertime},
        leaving its adjustment to the observer's measurement update.
        \begin{equation}
            y_{\text{gyro}} = \omega + b + e_{\text{gyro}}
        \end{equation}
        \begin{equation}
            \label{eq:filter:sensormodels:accelerometertime}
            \dot{b} = 0 + e_{\text{bias}}
        \end{equation}

    \subsection{Magnetometers}
        Capable of sensing magnetic fields, the magnetometers can be used to
        sense the direction of the Earth's magnetic field and, from knowing
        the field at the current location, estimate the orientation of a vehicle.
        \begin{equation}
            y = R(q) m^{e} + e_{m}
        \end{equation}
        The Earth's magnetic field can initialized at startup, or approximated using the World Magnetic Model\cite{wmm2010},
        which for Link√∂ping, Sweden, is given in Eq.~\eqref{eq:observer:sensormodels:magneticfield}.
        \begin{equation}
            \label{eq:observer:sensormodels:magneticfield}
            m^{e} = \left[\left(\begin{array}{ccc}
                15.7 & 1.11 & 48.4
            \end{array}\right)^{T}\right]^{NEDEF} \mu T
        \end{equation}

        Magnetometer measurements are, however, very sensitive to disturbances, and in indoor
        flight, measurements are often useless due to electrical wiring, lighting etc.
        Thus, the magnetometers were not used for the state estimation in this thesis.

    \subsection{Pressure Sensor}
        The barometric pressure, $p$, can be related to altitude using Eq.~\eqref{eq:sensormodels:pressure} \cite{physicshandbook}.
        The pressure sensor, as shown in the validation, is inherently
        noisy and especially so in an indoor environment where air conditioning
        causes disturbances in the relatively small - and thus pressure sensitive -
        environments that are available indoors.
        The pressure sensor is also affected by propeller turbulence, but 
        is placed inside the plastic hull of the LinkQuad to reduce disturbance.
        \begin{equation}
            \label{eq:sensormodels:pressure}
            p = p_{0} \left( 1 - \frac{L \cdot h}{T_{0}} \right)^{\frac{g \cdot M}{R\cdot L}} + e_{p}
        \end{equation}
        \begin{table}
            \begin{tabularx}{\tablewidth}{|c|X|c|c|}\hline
                \textbf{Parameter} & \textbf{Description} & \textbf{Value} & \textbf{Unit} \\\hline
                $L$       & Temperature lapse rate.            & $0.0065$ & $\frac{\text{K}}{\text{m}}$ \\\hline
                $M$       & Molar mass of dry air.             & $0.0289644$ & $\frac{\text{kg}}{\text{mol}}$ \\\hline
                $p_{0}$   & Atmospheric pressure at sea level. & $101325$ & $\text{Pa}$ \\\hline
                $R$       & Universal gas constant.            & $8.31447$ & $\frac{\text{J}}{\text{mol} \cdot \text{K}}$ \\\hline
                $T_{0}$   & Standard temperature at sea level. & $288.15$ & $\text{K}$ \\\hline
            \end{tabularx}
            \label{tos:pressuresensor}
            \caption{Table of Symbols used in the pressure equation, Eq.~\eqref{eq:sensormodels:pressure}}.
        \end{table}

    \input{\currentchapter/camera}
